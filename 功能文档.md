# 云创AI视觉 - 队列批量生成系统功能文档

## 1. 项目概述
本项目是一个基于 Web 的轻量级 AI 视觉批量生成系统，主要用于调用 Gemini 等多模态大模型 API，实现基于产品图和提示词的批量图片生成任务。系统支持队列管理、并发控制、以及参考图辅助生成等功能。

## 2. 核心功能模块

### 2.1 API 配置管理
- **自定义配置**：支持用户配置 API 端点 (Endpoint)、API 密钥 (Key)、模型名称 (如 gemini-3-pro-image-preview)、图片比例及并发数。
- **安全存储**：
  - 使用 **Web Crypto API (AES-GCM)** 算法对敏感信息（如 API Key）进行本地加密存储。
  - 数据保存于浏览器 `localStorage`，页面刷新后自动解密恢复，保障安全性。
- **并发控制**：允许设置并发请求数量（建议 4-6），平衡生成速度与 API 速率限制。

### 2.2 图像与任务输入
- **产品图上传**：
  - 支持拖拽上传或点击选择。
  - 支持多文件上传（.jpg, .png, .webp 等格式）。
  - 提供上传图片预览与删除功能。
- **参考图上传（可选）**：
  - 支持单张或批量参考图上传。
  - **支持文件夹上传**，方便批量导入背景风格参考。
  - 清除与预览功能。
- **提示词编辑**：
  - 文本域输入生成提示词 (Prompt)。
  - 动态检测输入状态，仅当必要信息（图片、提示词、API配置）完备时才激活“添加到任务队列”按钮。

### 2.3 智能任务队列系统
- **任务创建逻辑**：
  - 将当前上传的产品图、参考图及提示词打包为一个“任务批次”。
  - **组合生成策略**：
    - **无参考图模式**：对每一张产品图，结合提示词生成一张结果图。
    - **有参考图模式**：对每一张产品图，分别与每一张参考图组合（笛卡尔积），生成所有组合的结果图。
- **队列控制**：
  - **开始/暂停**：支持随时启动或暂停队列处理。
  - **清空队列**：支持一键清空所有任务。
  - **实时状态**：显示总任务数、等待中、进行中、已完成及失败的任务统计。

### 2.4 生成与结果处理
- **批量并发生成**：
  - 根据设定的并发数，通过 `fetch` API 并行发送请求。
  - 实时显示批次进度条和百分比。
- **错误处理**：
  - 捕获 API 请求错误、JSON 解析错误及内容安全拦截（Safety Ratings）。
  - 失败任务会被标记，不会阻塞后续任务执行。
- **结果展示与下载**：
  - 生成成功的图片直接在任务卡片中展示。
  - **单张下载**：点击图片下的下载按钮保存单张。
  - **批量打包下载 (ZIP)**：
    - 集成 `JSZip` 库。
    - 支持将单个任务批次内的所有生成结果打包为 `.zip` 文件一键下载。
    - 自动命名文件（支持顺序编号）。

## 3. 技术特性
- **纯前端架构**：单文件 HTML/JS 实现，无后端依赖，部署简单（直接打开或静态托管）。
- **现代化 UI**：
  - 采用各种 CSS 变量与 Glassmorphism（毛玻璃）风格。
  - 响应式布局，适配不同屏幕尺寸。
  - 交互反馈丰富（Hover 效果、加载状态、动态徽标）。
- **数据处理**：
  - 使用 `FileReader` 读取本地图片并转换为 Base64 编码发送给 API。
  - 动态计算任务耗时与平均生成速度。

## 4. 文件结构
- **index.html**: 包含所有 HTML 结构、CSS 样式及 JavaScript 逻辑的核心文件。
- **依赖库**: 通过 CDN 引入 `jszip/3.10.1/jszip.min.js` 用于压缩包生成。
